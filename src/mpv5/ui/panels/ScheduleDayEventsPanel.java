/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

/*
 * SplashScreen.java
 *
 * Created on 30.03.2009, 21:55:52
 */
package mpv5.ui.panels;

import java.util.ArrayList;

import java.util.Calendar;
import java.util.Date;
import javax.swing.JPanel;
import mpv5.db.common.Context;
import mpv5.db.common.DatabaseObject;
import mpv5.db.common.NodataFoundException;
import mpv5.db.common.QueryCriteria;
import mpv5.db.objects.Schedule;
import mpv5.db.objects.User;
import mpv5.globals.Headers;
import mpv5.logging.Log;
import mpv5.ui.dialogs.ScheduleEvents;
import mpv5.ui.panels.calendar.ScheduleCalendarDayChooser;
import mpv5.utils.models.MPTableModel;
import mpv5.utils.tables.TableFormat;

/**
 *
 *  
 */
public class ScheduleDayEventsPanel extends JPanel {

    private static final long serialVersionUID = 1L;
    private static ScheduleDayEventsPanel icke;

    public static ScheduleDayEventsPanel instanceOf() {
        if (icke == null) {
            icke = new ScheduleDayEventsPanel();
        } else {
//            icke.refresh(null);
        }
        return icke;
    }

    /**
     *
     * @param day
     */
    private ScheduleDayEventsPanel() {
        initComponents();
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel1 = new javax.swing.JPanel();
        but4 = new javax.swing.JButton();
        jScrollPane1 = new javax.swing.JScrollPane();
        jTable1 = new javax.swing.JTable();
        but5 = new javax.swing.JButton();

        setName("Form"); // NOI18N
        setLayout(new java.awt.BorderLayout());

        java.util.ResourceBundle bundle = mpv5.i18n.LanguageManager.getBundle(); // NOI18N
        jPanel1.setBorder(javax.swing.BorderFactory.createTitledBorder(bundle.getString("ScheduleDayEventsPanel.jPanel1.border.title_1"))); // NOI18N
        jPanel1.setName("jPanel1"); // NOI18N

        but4.setIcon(new javax.swing.ImageIcon(getClass().getResource("/mpv5/resources/images/32/view_right.png"))); // NOI18N
        but4.setText(bundle.getString("ScheduleDayEventsPanel.but4.text")); // NOI18N
        but4.setToolTipText(bundle.getString("ScheduleDayEventsPanel.but4.toolTipText")); // NOI18N
        but4.setContentAreaFilled(false);
        but4.setFocusable(false);
        but4.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        but4.setName("but4"); // NOI18N
        but4.setPressedIcon(new javax.swing.ImageIcon(getClass().getResource("/mpv5/resources/images/32/xclock.png"))); // NOI18N
        but4.setRolloverIcon(new javax.swing.ImageIcon(getClass().getResource("/mpv5/resources/images/32/view_right.png"))); // NOI18N
        but4.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        but4.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                but4ActionPerformed(evt);
            }
        });

        jScrollPane1.setName("jScrollPane1"); // NOI18N

        jTable1.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {},
                {},
                {},
                {}
            },
            new String [] {

            }
        ));
        jTable1.setName("jTable1"); // NOI18N
        jScrollPane1.setViewportView(jTable1);

        but5.setIcon(new javax.swing.ImageIcon(getClass().getResource("/mpv5/resources/images/32/edittrash.png"))); // NOI18N
        but5.setText(bundle.getString("ScheduleDayEventsPanel.but5.text")); // NOI18N
        but5.setToolTipText(bundle.getString("ScheduleDayEventsPanel.but5.toolTipText")); // NOI18N
        but5.setContentAreaFilled(false);
        but5.setFocusable(false);
        but5.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        but5.setName("but5"); // NOI18N
        but5.setPressedIcon(new javax.swing.ImageIcon(getClass().getResource("/mpv5/resources/images/32/xclock.png"))); // NOI18N
        but5.setRolloverIcon(new javax.swing.ImageIcon(getClass().getResource("/mpv5/resources/images/32/bright_edittrash.png"))); // NOI18N
        but5.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        but5.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                but5ActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel1Layout.createSequentialGroup()
                .addGap(19, 19, 19)
                .addComponent(but4, javax.swing.GroupLayout.PREFERRED_SIZE, 39, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 109, Short.MAX_VALUE)
                .addComponent(but5, javax.swing.GroupLayout.PREFERRED_SIZE, 39, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(19, 19, 19))
            .addComponent(jScrollPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 225, Short.MAX_VALUE)
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel1Layout.createSequentialGroup()
                .addComponent(jScrollPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 410, Short.MAX_VALUE)
                .addGap(18, 18, 18)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(but5, javax.swing.GroupLayout.PREFERRED_SIZE, 39, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(but4, javax.swing.GroupLayout.PREFERRED_SIZE, 39, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(15, 15, 15))
        );

        add(jPanel1, java.awt.BorderLayout.LINE_START);
    }// </editor-fold>//GEN-END:initComponents

    private void but4ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_but4ActionPerformed
        Log.Debug(this,
                "adding new schedule from Homescreen");
        ScheduleEvents.instanceOf();
}//GEN-LAST:event_but4ActionPerformed

    private void but5ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_but5ActionPerformed
        Schedule d = (Schedule) jTable1.getModel().getValueAt(jTable1.convertRowIndexToModel(jTable1.getSelectedRow()), 0);
        Log.Debug(this,
                "deleting the marked entry from Homescreen (and database :-) )");
        Calendar cal = Calendar.getInstance();
        cal.setTime(d.__getStartdate());
        Date oldDate = cal.getTime();
        ScheduleCalendarDayChooser.instanceOf().refreshDayPanels(oldDate, d, Boolean.FALSE);
        d.delete();
        refresh(ScheduleCalendarDayChooser.instanceOf().getScheduledEvents(d.__getStartdate()));
}//GEN-LAST:event_but5ActionPerformed

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton but4;
    private javax.swing.JButton but5;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JTable jTable1;
    // End of variables declaration//GEN-END:variables

    private void refresh(ArrayList<Schedule> list) {
        Log.Debug(this, "Refreshing SDEPanel ...");
        if (list != null) {
            Object[][] data = new Object[list.size()][4];

            for (int i = 0; i < list.size(); i++) {
                Schedule schedule = list.get(i);
                data[i][0] = schedule;
                data[i][1] = schedule.__getCName();
                QueryCriteria qc = new QueryCriteria("USERSIDS", User.getCurrentUser().getID());
                qc.addAndCondition("IDS", schedule.__getEventtype());
                Log.Debug(this, "EventID: " + schedule.__getEventtype());
                ArrayList<DatabaseObject> SType;
                try {
                    SType = DatabaseObject.getObjects(Context.getScheduleTypes(),
                            qc);
                    data[i][3] = SType.get(0).__getCName();
                } catch (NodataFoundException ex) {
                    Log.Debug(this, ex);
                }

            }
            MPTableModel m = new MPTableModel(data, Headers.SCHEDULE_PANEL);
            jTable1.setModel(m);
            TableFormat.stripColumn(jTable1, 0);
            TableFormat.stripColumn(jTable1, 2);
            TableFormat.format(jTable1, 0, 140);
            if (list.isEmpty()) {
                but5.setEnabled(false);
            } else {
                but5.setEnabled(true);
            }
        } else {
            Object[][] data = new Object[0][4];
            MPTableModel m = new MPTableModel(data, Headers.SCHEDULE_PANEL);
            jTable1.setModel(m);
            TableFormat.stripColumn(jTable1, 0);
            TableFormat.stripColumn(jTable1, 2);
            TableFormat.format(jTable1, 0, 140);
            Log.Debug(this, "Delete off");
            but5.setEnabled(false);
        }
        this.validate();
    }

    public void setDayEvents(ArrayList<Schedule> list) {
        refresh(list);
    }
}
